# ==============================================================================
# IMPORTANT BUILD NOTES - READ BEFORE BUILDING
# ==============================================================================
#
# 1. CODESIGN ERROR "resource fork...detritus not allowed":
#    - Build with: -derivedDataPath /tmp/TheaBuild
#    - This avoids iCloud File Provider adding problematic extended attributes
#    - See BUILD_GUIDE.md for full details
#
# 2. MISSING PACKAGES (Highlightr, KeychainAccess, etc.):
#    - Run: xcodebuild -resolvePackageDependencies -project Thea.xcodeproj
#    - If still failing, delete DerivedData and Package.resolved, then retry
#
# 3. After modifying this file, regenerate project:
#    - Run: xcodegen generate
#
# ==============================================================================

name: Thea
options:
  bundleIdPrefix: app.thea
  deploymentTarget:
    macOS: "26.0"
    iOS: "26.0"
    watchOS: "26.0"
    tvOS: "26.0"
    visionOS: "26.0"
  xcodeVersion: "26.0"
  generateEmptyDirectories: true
  groupSortPosition: top
  developmentLanguage: en
  indentWidth: 4
  tabWidth: 4
  usesTabs: false
  defaultConfig: Release
  createIntermediateGroups: true
  transitivelyLinkDependencies: true

# ============================================
# Build Configurations
# ============================================
configs:
  Debug: debug
  Release: release

# ============================================
# Project-Level Build Settings
# ============================================
settings:
  base:
    # ===========================================
    # Version Information
    # ===========================================
    MARKETING_VERSION: "1.5.0"
    CURRENT_PROJECT_VERSION: "15"

    # ===========================================
    # Swift Configuration
    # ===========================================
    SWIFT_VERSION: "6.0"
    SWIFT_STRICT_CONCURRENCY: complete
    SWIFT_EMIT_MODULE_INTERFACE: NO
    BUILD_LIBRARY_FOR_DISTRIBUTION: NO
    SWIFT_ENFORCE_EXCLUSIVE_ACCESS: "full"

    # ===========================================
    # Code Signing
    # ===========================================
    CODE_SIGN_STYLE: Automatic
    DEVELOPMENT_TEAM: 6B66PM4JLK

    # ===========================================
    # Build Options
    # ===========================================
    DEAD_CODE_STRIPPING: YES
    ENABLE_USER_SCRIPT_SANDBOXING: YES
    CLANG_ENABLE_MODULES: YES
    CLANG_ENABLE_OBJC_ARC: YES
    ENABLE_STRICT_OBJC_MSGSEND: YES
    GCC_NO_COMMON_BLOCKS: YES

    # ===========================================
    # Swift Package Dependencies
    # ===========================================
    SWIFT_INCLUDE_PATHS: "$(inherited)"

    # ===========================================
    # Localization (Xcode 16 recommended)
    # ===========================================
    LOCALIZATION_EXPORT_SUPPORTED: YES
    SWIFT_EMIT_LOC_STRINGS: YES
    STRING_CATALOG_GENERATE_SYMBOLS: YES
    LOCALIZATION_PREFERS_STRING_CATALOGS: YES
    LOCALIZED_STRING_SWIFTUI_SUPPORT: YES

    # ===========================================
    # Asset Catalog (Xcode 16 recommended)
    # ===========================================
    ASSETCATALOG_COMPILER_GENERATE_ASSET_SYMBOLS: YES
    ASSETCATALOG_COMPILER_GENERATE_SWIFT_ASSET_SYMBOL_EXTENSIONS: YES

    # ===========================================
    # Clang Warnings - Implicit Conversions
    # ===========================================
    CLANG_WARN_BLOCK_CAPTURE_AUTORELEASING: YES
    CLANG_WARN_EMPTY_BODY: YES
    CLANG_WARN_BOOL_CONVERSION: YES
    CLANG_WARN_CONSTANT_CONVERSION: YES
    GCC_WARN_64_TO_32_BIT_CONVERSION: YES
    CLANG_WARN_ENUM_CONVERSION: YES
    CLANG_WARN_FLOAT_CONVERSION: YES
    CLANG_WARN_INT_CONVERSION: YES
    CLANG_WARN_NON_LITERAL_NULL_CONVERSION: YES
    CLANG_WARN_IMPLICIT_SIGN_CONVERSION: YES
    CLANG_WARN_SUSPICIOUS_IMPLICIT_CONVERSION: YES

    # ===========================================
    # Clang Warnings - Code Quality
    # ===========================================
    CLANG_WARN_INFINITE_RECURSION: YES
    CLANG_WARN_UNREACHABLE_CODE: YES
    CLANG_WARN_COMMA: YES
    CLANG_WARN_ASSIGN_ENUM: YES
    CLANG_WARN_STRICT_PROTOTYPES: YES
    CLANG_WARN_SEMICOLON_BEFORE_METHOD_BODY: YES
    CLANG_WARN_RANGE_LOOP_ANALYSIS: YES
    CLANG_WARN_QUOTED_INCLUDE_IN_FRAMEWORK_HEADER: YES

    # ===========================================
    # Clang Warnings - Documentation
    # ===========================================
    CLANG_WARN_DOCUMENTATION_COMMENTS: YES

    # ===========================================
    # Clang Warnings - Availability
    # ===========================================
    CLANG_WARN_UNGUARDED_AVAILABILITY: YES_AGGRESSIVE

    # ===========================================
    # Clang Warnings - Objective-C
    # ===========================================
    CLANG_WARN_DIRECT_OBJC_ISA_USAGE: YES_ERROR
    CLANG_WARN__DUPLICATE_METHOD_MATCH: YES
    CLANG_WARN_OBJC_LITERAL_CONVERSION: YES
    CLANG_WARN_OBJC_ROOT_CLASS: YES_ERROR
    CLANG_WARN_DEPRECATED_OBJC_IMPLEMENTATIONS: YES
    CLANG_WARN_OBJC_IMPLICIT_RETAIN_SELF: YES

    # ===========================================
    # GCC Warnings
    # ===========================================
    GCC_WARN_ABOUT_RETURN_TYPE: YES_ERROR
    GCC_WARN_UNDECLARED_SELECTOR: YES
    GCC_WARN_UNINITIALIZED_AUTOS: YES_AGGRESSIVE
    GCC_WARN_UNUSED_FUNCTION: YES
    GCC_WARN_UNUSED_VARIABLE: YES
    GCC_WARN_SHADOW: YES
    GCC_WARN_FOUR_CHARACTER_CONSTANTS: YES
    GCC_WARN_INITIALIZER_NOT_FULLY_BRACKETED: YES
    GCC_WARN_ABOUT_MISSING_FIELD_INITIALIZERS: YES
    GCC_WARN_ABOUT_MISSING_NEWLINE: YES
    GCC_WARN_SIGN_COMPARE: YES
    GCC_WARN_ABOUT_MISSING_PROTOTYPES: YES
    GCC_TREAT_INCOMPATIBLE_POINTER_TYPE_WARNINGS_AS_ERRORS: YES
    GCC_TREAT_IMPLICIT_FUNCTION_DECLARATIONS_AS_ERRORS: YES

    # ===========================================
    # Static Analyzer
    # ===========================================
    CLANG_ANALYZER_NONNULL: YES
    CLANG_ANALYZER_NUMBER_OBJECT_CONVERSION: YES_AGGRESSIVE
    CLANG_ANALYZER_LOCALIZABILITY_NONLOCALIZED: YES
    CLANG_ANALYZER_SECURITY_FLOATLOOPCOUNTER: YES
    CLANG_ANALYZER_SECURITY_INSECUREAPI_RAND: YES
    CLANG_ANALYZER_SECURITY_INSECUREAPI_STRCPY: YES

    # ===========================================
    # Security (NS_ASSERTIONS set per-config: YES for Debug, NO for Release)
    # ===========================================

  # ===========================================
  # Debug Configuration
  # ===========================================
  configs:
    Debug:
      # Optimization
      ONLY_ACTIVE_ARCH: YES
      SWIFT_OPTIMIZATION_LEVEL: "-Onone"
      SWIFT_COMPILATION_MODE: singlefile
      GCC_OPTIMIZATION_LEVEL: "0"

      # Debug Information
      DEBUG_INFORMATION_FORMAT: dwarf
      MTL_ENABLE_DEBUG_INFO: INCLUDE_SOURCE

      # Testability
      ENABLE_TESTABILITY: YES
      ENABLE_NS_ASSERTIONS: YES

      # Code Stripping
      COPY_PHASE_STRIP: NO
      GCC_DYNAMIC_NO_PIC: NO

      # Preprocessor
      SWIFT_ACTIVE_COMPILATION_CONDITIONS: DEBUG
      GCC_PREPROCESSOR_DEFINITIONS:
        - "$(inherited)"
        - "DEBUG=1"

    # ===========================================
    # Release Configuration
    # ===========================================
    Release:
      # Optimization
      ONLY_ACTIVE_ARCH: NO
      SWIFT_OPTIMIZATION_LEVEL: "-O"
      SWIFT_COMPILATION_MODE: wholemodule
      GCC_OPTIMIZATION_LEVEL: "s"

      # Debug Information
      DEBUG_INFORMATION_FORMAT: "dwarf-with-dsym"
      MTL_ENABLE_DEBUG_INFO: NO
      MTL_FAST_MATH: YES

      # Testability
      ENABLE_TESTABILITY: NO
      ENABLE_NS_ASSERTIONS: NO

      # Code Stripping
      DEAD_CODE_STRIPPING: YES
      COPY_PHASE_STRIP: NO

      # Deployment
      DEPLOYMENT_POSTPROCESSING: YES
      VALIDATE_PRODUCT: YES

      # Link Time Optimization
      LLVM_LTO: YES_THIN

      # Exclusive Access (compile-time only for release)
      SWIFT_ENFORCE_EXCLUSIVE_ACCESS: "compile-time"

# ============================================
# Package Dependencies
# ============================================
packages:
  OpenAI:
    url: https://github.com/MacPaw/OpenAI
    from: 0.2.0
  KeychainAccess:
    url: https://github.com/kishikawakatsumi/KeychainAccess
    from: 4.2.0
  MarkdownUI:
    url: https://github.com/gonzalezreal/swift-markdown-ui
    from: 2.0.0
  Highlightr:
    url: https://github.com/raspu/Highlightr
    from: 2.1.0
  # MLX Swift for native on-device LLM inference (macOS 26+ best practices)
  # Provides: MLX, MLXNN, MLXOptimizers, MLXRandom
  mlx-swift:
    url: https://github.com/ml-explore/mlx-swift
    from: 0.21.0
  # MLX LM for LLM/VLM implementations with HuggingFace Hub integration
  # Provides: MLXLLM, MLXVLM, MLXLMCommon, MLXEmbedders
  mlx-swift-lm:
    url: https://github.com/ml-explore/mlx-swift-lm
    branch: main

# ============================================
# Targets
# ============================================
targets:
  # ============ macOS App ============
  Thea-macOS:
    type: application
    platform: macOS
    deploymentTarget: "26.0"
    sources:
      - path: Shared
        excludes:
          - "**/*iOS*"
          - "**/*watchOS*"
          - "**/*tvOS*"
          - "**/*.md"
          - "**/Core/Interfaces/**"
          - "**/Core/Services/Mock*.swift"
          - "**/Core/Services/ChatService.swift"
          - "**/Core/Services/ProjectService.swift"
          # Exclude duplicate folders (use Shared/System/Terminal not Shared/Execution/Terminal)
          - "**/Execution/Terminal/**"
          # Exclude duplicate providers (use Shared/AI/Providers not Shared/Providers)
          # Also exclude AI/Providers files that depend on excluded Protocol types
          - "**/AI/Providers/AnthropicFilesAPI.swift"
          - "**/AI/Providers/AnthropicTokenCounter.swift"
          - "**/Providers/Anthropic/**"
          - "**/Providers/DeepSeek/**"
          - "**/Providers/Google/**"
          - "**/Providers/Groq/**"
          - "**/Providers/OpenAI/**"
          - "**/Providers/OpenRouter/**"
          - "**/Providers/Perplexity/**"
          - "**/Providers/Helpers/**"
          - "**/Providers/Protocol/**"
          - "**/Providers/Registry/**"
          # ============================================================
          # ARCHITECTURE DECISION (2026-02-07):
          # MetaAI folder is EXCLUDED - use Intelligence folder as canonical source.
          #
          # Context: MetaAI (~73 files) and Intelligence folders had duplicate
          # type definitions causing build conflicts. Rather than maintaining
          # two parallel implementations, Intelligence folder was chosen as
          # the canonical source because:
          #   1. It has cleaner separation of concerns (Core, Intent, Knowledge, etc.)
          #   2. It follows protocol-based design patterns
          #   3. It integrates better with the existing codebase
          #
          # If MetaAI files are needed in the future:
          #   1. Check for type conflicts with Intelligence folder
          #   2. Rename conflicting types with MetaAI prefix
          #   3. Remove specific exclusions below rather than the blanket exclusion
          #
          # DO NOT remove this blanket exclusion without resolving all type conflicts.
          # See git history for type renames already done (MetaAIMCPServerInfo, etc.)
          # ============================================================
          - "**/AI/MetaAI/**"
          # Exclude duplicate Integrations (use Apple subfolder)
          - "**/Integrations/NotesIntegration.swift"
          - "**/Integrations/RemindersIntegration.swift"
          # Exclude duplicate Memory (use Memory folder not AI/Memory)
          - "**/AI/Memory/**"
          # Exclude DesignTokens (duplicates TheaDesignSystem definitions)
          - "**/Theme/DesignTokens.swift"
          # Exclude duplicate Settings views (use subfolder versions)
          - "**/Settings/LocalModelsSettingsView.swift"
          - "**/Settings/AutonomousTaskSettingsView.swift"
          # Exclude MetaAI views that depend on excluded MetaAI folder
          - "**/Views/MetaAI/**"
          # Exclude views that depend on missing types
          - "**/Settings/OrchestratorSettingsView.swift"
          - "**/Settings/Orchestrator/**"
          - "**/Settings/MemorySettingsView.swift"
          - "**/Settings/PrivacySettingsView.swift"
          - "**/Settings/AdvancedSettingsView.swift"
          - "**/Settings/AIProvidersSettingsView.swift"
          # Verification + Anticipatory: excluded as tightly-coupled subsystems.
          # All files in each folder depend on each other; must be enabled together.
          - "**/ResourceManagement/**"
          - "**/Components/EnhancedMessageBubble.swift"
          - "**/Components/ExecutableCodeBlock.swift"
          - "**/Code/CodeIntelligence.swift"
          - "**/Views/Code/**"
          - "**/Settings/Privacy/**"
          - "**/Settings/ResourceAllocationSettingsView.swift"
          - "**/Views/SelfExecutionView.swift"
          - "**/AI/MultiModal/MultiModalCoordinator.swift"
          - "**/AI/MultiModal/MultiModalAnalyzer.swift"
          - "**/Theme/DesignTokens.swift"
          - "**/Core/DeviceCapabilityRouter.swift"
          - "**/Views/DeviceSwitcherView.swift"
          - "**/Components/THEAThinkingView.swift"
          - "**/Managers/ResponseNotificationHandler.swift"
          - "**/DistributedTaskExecutor.swift"
          # ============================================================
          # BLANKET DIRECTORY EXCLUSIONS (macOS)
          # These entire folders are excluded because they contain
          # abandoned, incomplete, or duplicate implementations.
          # Using blanket patterns prevents new files in these dirs
          # from accidentally breaking the build.
          # ============================================================
          - "**/PatternLearning/**"
          - "**/LifeMonitoring/**"
          - "**/LifeAssistant/**"
          - "**/Anticipatory/**"
          - "**/Prediction/**"
          - "**/Autonomy/**"
          # Automation: selective exclusion (AutomationEngine, AutomationAction,
          # BrowserAutomationOrchestrator, BrowserAutomationService, PermissionManager,
          # ScreenAnalyzer, UserInterventionDetector are actively used on macOS)
          - "**/Automation/AutonomousTaskExecutor.swift"
          - "**/Automation/ShortcutsOrchestrator.swift"
          - "**/Automation/ShortcutsService.swift"
          - "**/Automation/WorkflowRecorder.swift"
          - "**/Automation/WorkflowEngine.swift"
          - "**/Automation/ScheduledTasks/**"
          - "**/Automation/SmartTriggers/**"
          - "**/Autonomous/**"
          - "**/AgentMode/**"
          - "**/Intelligence/Orchestration/IntelligenceOrchestrator.swift"
          - "**/SelfEvolution/**"
          - "**/Squads/**"
          - "**/PromptEngineering/**"
          # LocalModels: selective exclusion (LocalModelManager, MLXModelManager,
          # MLXInferenceEngine, MLXModelScanner, LocalModelProvider are actively used)
          - "**/LocalModels/ProactiveModelManager.swift"
          - "**/LocalModels/LocalModelRecommendationEngine.swift"
          - "**/LocalModels/LocalModelRecommendationEngine+*.swift"
          - "**/LocalModels/LocalModelRecommendationTypes.swift"
          - "**/LocalModels/AIModelGovernor.swift"
          - "**/LocalModels/ModelGovernanceEngine.swift"
          - "**/LocalModels/UnifiedLocalModelOrchestrator.swift"
          - "**/LocalModels/SupraModelSelector.swift"
          - "**/LocalModels/OllamaAgentLoop.swift"
          - "**/LocalModels/ModelQualityBenchmark.swift"
          - "**/LocalModels/PredictivePreloader.swift"
          - "**/AI/Context/**"
          - "**/AI/Adaptive/**"
          - "**/AI/Proactive/**"
          - "**/ResourceManagement/**"
          - "**/Widgets/**"
          - "**/Views/Code/**"
          - "**/Views/LocalModels/**"
          - "**/Views/LifeTracking/**"
          - "**/Settings/Advanced/**"
          - "**/Settings/LocalModels/**"
          - "**/Settings/Privacy/**"
          - "**/Settings/Orchestrator/**"
          - "**/Settings/AutonomousTasks/**"
          # ============================================================
          # INDIVIDUAL FILE EXCLUSIONS (macOS)
          # Files outside the blanket-excluded directories that still
          # need to be excluded due to missing types or dependencies.
          # ============================================================
          - "**/Configuration/ConfigurationManager.swift"
          - "**/Components/ConfidenceIndicatorViews.swift"
          - "**/Components/EnhancedMessageBubble.swift"
          - "**/Components/ExecutableCodeBlock.swift"
          - "**/Components/THEAThinkingView.swift"
          - "**/Components/QuerySuggestionOverlay.swift"
          - "**/Components/MemoryContextView.swift"
          - "**/Components/StreamingTextView.swift"
          - "**/Components/TheaTextInputField.swift"
          - "**/Views/PhaseProgressView.swift"
          - "**/Views/SelfExecutionView.swift"
          - "**/Views/DeviceSwitcherView.swift"
          - "**/Views/KeyboardShortcutsView.swift"
          - "**/Views/KeyboardShortcutsHelpView.swift"
          - "**/Managers/ErrorKnowledgeBaseManager.swift"
          - "**/Managers/IntegrationsManager.swift"
          - "**/Managers/ResponseNotificationHandler.swift"
          - "**/Integrations/IntegrationModule.swift"
          - "**/Integrations/MCPConnectionManager.swift"
          - "**/Integrations/MCPGateway.swift"
          - "**/Integrations/MailIntegration.swift"
          - "**/Integrations/TerminalIntegration.swift"
          - "**/Integrations/MusicIntegration.swift"
          - "**/Integrations/SystemIntegration.swift"
          - "**/Integrations/FinderIntegration.swift"
          - "**/Integrations/SafariIntegration.swift"
          - "**/Integrations/CalendarIntegration.swift"
          - "**/Integrations/ShortcutsIntegration.swift"
          - "**/Integrations/MessagesIntegration.swift"
          - "**/Integrations/XcodeIntegration.swift"
          - "**/Memory/LongTermMemoryManager.swift"
          - "**/Memory/ActiveMemoryRetrieval.swift"
          - "**/Memory/MemoryAugmentedChat.swift"
          - "**/MetaAI/ModelBenchmarkService.swift"
          - "**/Platforms/PlatformFeaturesHub.swift"
          - "**/TextProcessing/LiveAutoCorrect.swift"
          - "**/MCP/THEAMCPServer.swift"
          - "**/DeviceAwareness/UnifiedDeviceAwareness.swift"
          - "**/Code/CodeIntelligence.swift"
          - "**/AI/MultiModal/MultiModalCoordinator.swift"
          - "**/AI/MultiModal/MultiModalAnalyzer.swift"
          - "**/Core/DeviceCapabilityRouter.swift"
          - "**/Core/TheaIntegrationHub.swift"
          - "**/Execution/Testing/TestGenerator.swift"
          - "**/V1Parity/MessageRegeneration.swift"
          - "**/RemoteServer/RemoteCommandService.swift"
          - "**/Launcher/QuickLauncher.swift"
          - "**/Integration/TheaIntegrationHub+NewFeatures.swift"
          - "**/Intelligence/Subagents/**"
          # Settings views with missing dependencies
          - "**/Settings/OrchestratorSettingsView.swift"
          - "**/Settings/MemorySettingsView.swift"
          - "**/Settings/PermissionsSettingsView.swift"
          - "**/Settings/PrivacySettingsView.swift"
          - "**/Settings/AdvancedSettingsView.swift"
          - "**/Settings/AIProvidersSettingsView.swift"
          - "**/Settings/LocalModelsSettingsView.swift"
          - "**/Settings/AutonomousTaskSettingsView.swift"
          - "**/Settings/ResourceAllocationSettingsView.swift"
          - "**/Settings/SettingsPrivacyAboutViews.swift"
          - "**/Settings/AutoCorrectSettingsView.swift"
          - "**/Settings/AIFeaturesSettingsView.swift"
          - "**/Settings/SettingsConfigurationViews.swift"
          - "**/Settings/PromptEngineeringSettingsView.swift"
          - "**/Settings/AutomationSettingsView.swift"
          - "**/Settings/WorkflowSettingsView.swift"
          - "**/Settings/TerminalSettingsView.swift"
          - "**/Settings/IntegrationsSettingsView.swift"
          - "**/Settings/AutonomousSettingsView.swift"
          - "**/Settings/SystemPromptSettingsView.swift"
          - "**/ViewModels/SettingsViewModel.swift"
          # Theme exclusions
          - "**/Theme/DesignTokens.swift"
          - "**/Theme/TheaAnimations.swift"
          # Exclude design stubs on macOS (TheaDesignSystem is included on macOS)
          - "**/Design/DesignSystemStubs.swift"
      - path: macOS
      - path: Shared/Resources/Assets.xcassets
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.macos
        PRODUCT_NAME: Thea
        PRODUCT_MODULE_NAME: TheaCore
        INFOPLIST_FILE: macOS/Info.plist
        CODE_SIGN_ENTITLEMENTS: macOS/Thea.entitlements
        ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
        ASSETCATALOG_COMPILER_INCLUDE_ALL_APPICON_ASSETS: YES
        MACOSX_DEPLOYMENT_TARGET: "26.0"
        COMBINE_HIDPI_IMAGES: YES

        # Hardened Runtime (required for notarization)
        ENABLE_HARDENED_RUNTIME: YES

        # App Sandbox - DISABLED for full system access
        # Note: Required for Mac App Store, but Thea needs unsandboxed access for:
        # - Local MLX/GGUF models in ~/Library/Application Support/SharedLLMs
        # - AppleScript automation
        # - Running local AI processes (ollama, mlx-lm)
        # - Full file system access for code analysis
        # If distributing via Mac App Store, re-enable this
        ENABLE_APP_SANDBOX: NO

        # Network Connections
        ENABLE_INCOMING_NETWORK_CONNECTIONS: YES
        ENABLE_OUTGOING_NETWORK_CONNECTIONS: YES

        # App Groups
        REGISTER_APP_GROUPS: YES

        # Code Signing Identity
        CODE_SIGN_IDENTITY: "Apple Development"

        # Runpath Search Paths
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/../Frameworks"

      debug:
        CODE_SIGN_IDENTITY: "Apple Development"

      release:
        CODE_SIGN_IDENTITY: "Apple Distribution"
        SWIFT_TREAT_WARNINGS_AS_ERRORS: YES
        GCC_TREAT_WARNINGS_AS_ERRORS: YES

    dependencies:
      - package: OpenAI
      - package: KeychainAccess
      - package: MarkdownUI
      - package: Highlightr
      # MLX Swift for native on-device LLM inference (macOS only)
      - package: mlx-swift
        products:
          - MLX
          - MLXNN
      - package: mlx-swift-lm
        products:
          - MLXLLM
          - MLXLMCommon
      - target: TheaFinderSyncExtension
        embed: true
        codeSign: true
      - target: TheaQuickLookExtension
        embed: true
        codeSign: true
      - target: TheaSafariExtensionMac
        embed: true
        codeSign: true

  # ============ iOS App ============
  Thea-iOS:
    type: application
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Shared
        excludes:
          - "**/*macOS*"
          - "**/*watchOS*"
          - "**/*tvOS*"
          - "**/*.md"
          - "**/Core/Interfaces/**"
          - "**/Core/Services/Mock*.swift"
          - "**/Core/Services/ChatService.swift"
          - "**/Core/Services/ProjectService.swift"
          - "**/Terminal/**"
          - "**/ScreenCapture.swift"
          - "**/InputTrackingManager.swift"
          - "**/*AutomationEngine.swift"
          - "**/AppIntegration/**"
          - "**/TerminalService.swift"
          - "**/TerminalIntegration.swift"
          - "**/DisplayProfileManager.swift"
          - "**/DisplayService.swift"
          - "**/DisplayModels.swift"
          - "**/MLXModelManager.swift"
          - "**/ScreenshotPreview.swift"
          - "**/LocalModelsView.swift"
          - "**/LocalModelsSettingsView.swift"
          - "**/FolderAccessManager.swift"
          - "**/RemoteScreenService.swift"
          - "**/RemoteInputService.swift"
          - "**/RemoteSystemService.swift"
          - "**/Resources/Info.plist"
          # Exclude duplicate folders
          - "**/Execution/Terminal/**"
          - "**/Providers/Anthropic/**"
          - "**/Providers/DeepSeek/**"
          - "**/Providers/Google/**"
          - "**/Providers/Groq/**"
          - "**/Providers/OpenAI/**"
          - "**/Providers/OpenRouter/**"
          - "**/Providers/Perplexity/**"
          - "**/Providers/Helpers/**"
          - "**/Providers/Protocol/**"
          - "**/Providers/Registry/**"
          # Exclude Anthropic files that depend on excluded ProviderError/ChatContentPart types
          - "**/AI/Providers/AnthropicFilesAPI.swift"
          - "**/AI/Providers/AnthropicTokenCounter.swift"
          # ARCHITECTURE DECISION: MetaAI excluded - see macOS target for full explanation
          - "**/AI/MetaAI/**"
          - "**/Integrations/NotesIntegration.swift"
          - "**/Integrations/RemindersIntegration.swift"
          - "**/AI/Memory/**"
          - "**/Settings/LocalModelsSettingsView.swift"
          - "**/Settings/AutonomousTaskSettingsView.swift"
          # Same exclusions as macOS for missing dependencies
          - "**/Views/MetaAI/**"
          - "**/Settings/OrchestratorSettingsView.swift"
          - "**/Settings/Orchestrator/**"
          - "**/Settings/MemorySettingsView.swift"
          - "**/Settings/PermissionsSettingsView.swift"
          - "**/Settings/PrivacySettingsView.swift"
          - "**/Settings/AdvancedSettingsView.swift"
          - "**/Settings/AIProvidersSettingsView.swift"
          - "**/ResourceManagement/**"
          - "**/Components/EnhancedMessageBubble.swift"
          - "**/Components/ExecutableCodeBlock.swift"
          - "**/Code/CodeIntelligence.swift"
          - "**/Views/Code/**"
          - "**/Settings/Privacy/**"
          - "**/Settings/ResourceAllocationSettingsView.swift"
          - "**/Views/SelfExecutionView.swift"
          - "**/AI/MultiModal/MultiModalCoordinator.swift"
          - "**/AI/MultiModal/MultiModalAnalyzer.swift"
          # LiquidGlassStyle and DesignTokens kept for iOS/iPadHomeView
          - "**/Core/DeviceCapabilityRouter.swift"
          - "**/Views/DeviceSwitcherView.swift"
          - "**/Components/THEAThinkingView.swift"
          - "**/Managers/ResponseNotificationHandler.swift"
          - "**/DistributedTaskExecutor.swift"
          - "**/LifeMonitoring/**"
          - "**/PatternLearning/**"
          - "**/AI/Context/**"
          - "**/Configuration/ConfigurationManager.swift"
          - "**/Settings/Advanced/**"
          - "**/Components/ConfidenceIndicatorViews.swift"
          - "**/Views/PhaseProgressView.swift"
          - "**/Managers/ErrorKnowledgeBaseManager.swift"
          - "**/AgentMode/AgentEnhancements.swift"
          - "**/Integrations/IntegrationModule.swift"
          - "**/Memory/LongTermMemoryManager.swift"
          - "**/Integrations/MCPConnectionManager.swift"
          - "**/Integrations/MCPGateway.swift"
          - "**/Integrations/MailIntegration.swift"
          - "**/Anticipatory/IntentAnticipator.swift"
          - "**/Classification/TaskClassifier.swift"
          - "**/LifeMonitoring/TaskIntelligence.swift"
          - "**/Integrations/MusicIntegration.swift"
          - "**/Integrations/SystemIntegration.swift"
          - "**/AI/Adaptive/AdaptivePromptEngine.swift"
          - "**/LocalModels/ProactiveModelManager.swift"
          - "**/LocalModels/LocalModelRecommendationEngine.swift"
          - "**/LocalModels/LocalModelRecommendationEngine+*.swift"
          - "**/LocalModels/LocalModelRecommendationTypes.swift"
          - "**/LocalModels/AIModelGovernor.swift"
          - "**/LocalModels/ModelGovernanceEngine.swift"
          - "**/LocalModels/UnifiedLocalModelOrchestrator.swift"
          - "**/MetaAI/ModelBenchmarkService.swift"
          - "**/AI/Proactive/ProactivityEngine.swift"
          - "**/Settings/AutonomousSettingsView.swift"
          - "**/Settings/LocalModels/**"
          - "**/Integrations/FinderIntegration.swift"
          - "**/Views/LocalModels/**"
          - "**/Platforms/PlatformFeaturesHub.swift"
          - "**/TextProcessing/LiveAutoCorrect.swift"
          - "**/Settings/AutoCorrectSettingsView.swift"
          - "**/Integrations/SafariIntegration.swift"
          - "**/Components/ChatInputView.swift"
          - "**/Search/SemanticSearchService.swift"
          - "**/Components/QuerySuggestionOverlay.swift"
          - "**/Settings/AIFeaturesSettingsView.swift"
          - "**/Memory/ActiveMemoryRetrieval.swift"
          - "**/Components/MemoryContextView.swift"
          - "**/Components/StreamingTextView.swift"
          - "**/MCP/THEAMCPServer.swift"
          - "**/DeviceAwareness/UnifiedDeviceAwareness.swift"
          - "**/Prediction/ModelPrewarmingService.swift"
          - "**/Routing/ModelRouter.swift"
          - "**/Autonomous/BlueprintExecutor.swift"
          - "**/Integrations/CalendarIntegration.swift"
          - "**/Integrations/ShortcutsIntegration.swift"
          - "**/Automation/ShortcutsOrchestrator.swift"
          - "**/Settings/SettingsPrivacyAboutViews.swift"
          - "**/ViewModels/SettingsViewModel.swift"
          - "**/V1Parity/MessageRegeneration.swift"
          - "**/Integrations/MessagesIntegration.swift"
          - "**/PromptEngineering/PromptOptimizer.swift"
          - "**/RemoteServer/RemoteCommandService.swift"
          - "**/Settings/SettingsConfigurationViews.swift"
          - "**/Settings/PromptEngineeringSettingsView.swift"
          - "**/PromptEngineering/AutomaticPromptEngineering.swift"
          - "**/Settings/AutomationSettingsView.swift"
          - "**/AgentMode/AutonomousAgentV3.swift"
          - "**/SelfEvolution/AutonomousImprovement.swift"
          - "**/Views/KeyboardShortcutsView.swift"
          - "**/LifeAssistant/LifeAssistantService.swift"
          - "**/Views/LifeTracking/**"
          - "**/Settings/TerminalSettingsView.swift"
          - "**/Execution/Testing/TestGenerator.swift"
          - "**/Theme/TheaAnimations.swift"
          - "**/Automation/WorkflowEngine.swift"
          - "**/Settings/WorkflowSettingsView.swift"
          - "**/Integrations/XcodeIntegration.swift"
          - "**/Autonomy/AutonomousMaintenanceService.swift"
          - "**/Automation/AutonomousTaskExecutor.swift"
          - "**/Autonomy/AutonomyController.swift"
          - "**/Settings/AutonomousTasks/**"
          - "**/Squads/SquadOrchestrator.swift"
          - "**/LocalModels/SupraModelSelector.swift"
          - "**/Core/TheaIntegrationHub.swift"
          - "**/Launcher/QuickLauncher.swift"
          - "**/Memory/MemoryAugmentedChat.swift"
          - "**/Integration/TheaIntegrationHub+NewFeatures.swift"
          - "**/Components/TheaTextInputField.swift"
          - "**/Anticipatory/InterventionScheduler.swift"
          - "**/Views/KeyboardShortcutsHelpView.swift"
          - "**/Anticipatory/AnticipatoryIntelligenceCore.swift"
          - "**/LocalModels/**"
          - "**/Focus/FocusOrchestrator.swift"
          - "**/V1Parity/SiriIntegration.swift"
          # Exclude macOS-only browser automation files
          - "**/Automation/BrowserAutomationOrchestrator.swift"
          - "**/Automation/UserInterventionDetector.swift"
          - "**/Automation/ScreenAnalyzer.swift"
          - "**/Automation/AutomationAction.swift"
          # TheaDesignSystem.swift KEPT for iOS - contains design tokens
          - "**/Design/LiquidGlassDesign.swift"
          # Exclude stubs since TheaDesignSystem is included
          - "**/Design/DesignSystemStubs.swift"
      - path: iOS
      - path: Shared/Resources/Assets.xcassets
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios
        PRODUCT_NAME: Thea
        PRODUCT_MODULE_NAME: TheaCore
        INFOPLIST_FILE: iOS/Info.plist
        CODE_SIGN_ENTITLEMENTS: iOS/Thea.entitlements
        ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
        ASSETCATALOG_COMPILER_INCLUDE_ALL_APPICON_ASSETS: YES
        TARGETED_DEVICE_FAMILY: "1,2"
        IPHONEOS_DEPLOYMENT_TARGET: "26.0"
        SUPPORTS_MACCATALYST: NO

        # Code Signing Identity
        CODE_SIGN_IDENTITY: "iPhone Developer"

        # Runpath Search Paths
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"

      debug:
        CODE_SIGN_IDENTITY: "iPhone Developer"

      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"
        SWIFT_TREAT_WARNINGS_AS_ERRORS: YES
        GCC_TREAT_WARNINGS_AS_ERRORS: YES

    dependencies:
      - package: OpenAI
      - package: KeychainAccess
      - package: MarkdownUI
      - package: Highlightr
      - target: TheaShareExtension
        embed: true
        codeSign: true
      - target: TheaWidgetExtension
        embed: true
        codeSign: true
      - target: TheaKeyboardExtension
        embed: true
        codeSign: true
      - target: TheaNotificationServiceExtension
        embed: true
        codeSign: true
      - target: TheaSafariExtension
        embed: true
        codeSign: true
      - target: TheaFocusFilterExtension
        embed: true
        codeSign: true
      - target: TheaCredentialsExtension
        embed: true
        codeSign: true
      - target: TheaIntentsExtension
        embed: true
        codeSign: true

  # ============ watchOS App ============
  Thea-watchOS:
    type: application
    platform: watchOS
    deploymentTarget: "26.0"
    sources:
      - path: watchOS
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.watchos
        PRODUCT_NAME: "Thea Watch"
        PRODUCT_MODULE_NAME: TheaWatch
        INFOPLIST_FILE: watchOS/Info.plist
        CODE_SIGN_ENTITLEMENTS: watchOS/Thea.entitlements
        ASSETCATALOG_COMPILER_APPICON_NAME: ""
        WATCHOS_DEPLOYMENT_TARGET: "26.0"
        TARGETED_DEVICE_FAMILY: 4
        SKIP_INSTALL: NO

        # Code Signing (explicit for watchOS)
        CODE_SIGN_STYLE: Automatic
        DEVELOPMENT_TEAM: 6B66PM4JLK
        CODE_SIGN_IDENTITY: "Apple Development"

        # Runpath Search Paths
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"

      debug:
        CODE_SIGN_IDENTITY: "iPhone Developer"

      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"
        SWIFT_TREAT_WARNINGS_AS_ERRORS: YES
        GCC_TREAT_WARNINGS_AS_ERRORS: YES

    dependencies:
      - package: KeychainAccess

  # ============ tvOS App ============
  Thea-tvOS:
    type: application
    platform: tvOS
    deploymentTarget: "26.0"
    sources:
      - path: tvOS
        excludes:
          - "**/TVFeatures/**"
      - path: Shared/Resources/Assets.xcassets
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.tvos
        PRODUCT_NAME: "Thea TV"
        PRODUCT_MODULE_NAME: TheaTV
        INFOPLIST_FILE: tvOS/Info.plist
        CODE_SIGN_ENTITLEMENTS: tvOS/Thea.entitlements
        ASSETCATALOG_COMPILER_APPICON_NAME: ""
        TVOS_DEPLOYMENT_TARGET: "26.0"
        TARGETED_DEVICE_FAMILY: 3

        # Code Signing (explicit for tvOS)
        CODE_SIGN_STYLE: Automatic
        DEVELOPMENT_TEAM: 6B66PM4JLK
        CODE_SIGN_IDENTITY: "Apple Development"

        # Runpath Search Paths
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"

      debug:
        CODE_SIGN_IDENTITY: "iPhone Developer"

      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"
        SWIFT_TREAT_WARNINGS_AS_ERRORS: YES
        GCC_TREAT_WARNINGS_AS_ERRORS: YES

    dependencies:
      - package: OpenAI
      - package: KeychainAccess
      - package: MarkdownUI

  # ============================================
  # iOS Extensions
  # ============================================

  # ============ Share Extension (iOS) ============
  TheaShareExtension:
    type: app-extension
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/ShareExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios.share
        PRODUCT_NAME: "Share to Thea"
        INFOPLIST_FILE: Extensions/ShareExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/ShareExtension/ShareExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "iPhone Developer"
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"
          - "@executable_path/../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"

  # ============ Widget Extension (iOS) ============
  TheaWidgetExtension:
    type: app-extension
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/WidgetExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios.widgets
        PRODUCT_NAME: "Thea Widgets"
        INFOPLIST_FILE: Extensions/WidgetExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/WidgetExtension/WidgetExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "iPhone Developer"
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"
          - "@executable_path/../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"

  # ============ Keyboard Extension (iOS) ============
  TheaKeyboardExtension:
    type: app-extension
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/KeyboardExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios.keyboard
        PRODUCT_NAME: "Thea Keyboard"
        INFOPLIST_FILE: Extensions/KeyboardExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/KeyboardExtension/KeyboardExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "iPhone Developer"
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"
          - "@executable_path/../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"

  # ============ Notification Service Extension (iOS) ============
  TheaNotificationServiceExtension:
    type: app-extension
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/NotificationServiceExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios.notifications
        PRODUCT_NAME: "Thea Notifications"
        INFOPLIST_FILE: Extensions/NotificationServiceExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/NotificationServiceExtension/NotificationServiceExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "iPhone Developer"
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"
          - "@executable_path/../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"

  # ============================================
  # macOS Extensions
  # ============================================

  # ============ Finder Sync Extension (macOS) ============
  TheaFinderSyncExtension:
    type: app-extension
    platform: macOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/FinderSyncExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.macos.finder
        PRODUCT_NAME: "Thea Finder"
        INFOPLIST_FILE: Extensions/FinderSyncExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/FinderSyncExtension/FinderSyncExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "Apple Development"
        ENABLE_HARDENED_RUNTIME: YES
        ENABLE_APP_SANDBOX: YES
        REGISTER_APP_GROUPS: YES
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/../Frameworks"
          - "@executable_path/../../../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "Apple Distribution"

  # ============ Quick Look Extension (macOS) ============
  TheaQuickLookExtension:
    type: app-extension
    platform: macOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/QuickLookExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.macos.quicklook
        PRODUCT_NAME: "Thea Quick Look"
        INFOPLIST_FILE: Extensions/QuickLookExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/QuickLookExtension/QuickLookExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "Apple Development"
        ENABLE_HARDENED_RUNTIME: YES
        ENABLE_APP_SANDBOX: YES
        REGISTER_APP_GROUPS: YES
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/../Frameworks"
          - "@executable_path/../../../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "Apple Distribution"

  # ============ Safari Extension (macOS) ============
  TheaSafariExtensionMac:
    type: app-extension
    platform: macOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/SafariExtension
        excludes:
          - "Resources/background/**"
          - "Resources/content/**"
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.macos.safari
        PRODUCT_NAME: "Thea"
        INFOPLIST_FILE: Extensions/SafariExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/SafariExtension/SafariExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "Apple Development"
        ENABLE_HARDENED_RUNTIME: YES
        ENABLE_APP_SANDBOX: YES
        REGISTER_APP_GROUPS: YES
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/../Frameworks"
          - "@executable_path/../../../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "Apple Distribution"

  # ============================================
  # Additional iOS Extensions
  # ============================================

  # ============ Safari Extension (iOS) ============
  TheaSafariExtension:
    type: app-extension
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/SafariExtension
        excludes:
          - "Resources/background/**"
          - "Resources/content/**"
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios.safari
        PRODUCT_NAME: "Thea"
        INFOPLIST_FILE: Extensions/SafariExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/SafariExtension/SafariExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "iPhone Developer"
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"
          - "@executable_path/../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"

  # ============ Focus Filter Extension (iOS) ============
  TheaFocusFilterExtension:
    type: app-extension
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/FocusFilterExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios.focusfilter
        PRODUCT_NAME: "Thea Focus"
        INFOPLIST_FILE: Extensions/FocusFilterExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/FocusFilterExtension/FocusFilterExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "iPhone Developer"
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"
          - "@executable_path/../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"

  # ============ Credentials Extension (iOS) ============
  TheaCredentialsExtension:
    type: app-extension
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/CredentialsExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios.credentials
        PRODUCT_NAME: "Thea Credentials"
        INFOPLIST_FILE: Extensions/CredentialsExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/CredentialsExtension/CredentialsExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "iPhone Developer"
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"
          - "@executable_path/../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"

  # ============ Intents Extension (iOS) ============
  TheaIntentsExtension:
    type: app-extension
    platform: iOS
    deploymentTarget: "26.0"
    sources:
      - path: Extensions/IntentsExtension
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.ios.intents
        PRODUCT_NAME: "Thea Intents"
        INFOPLIST_FILE: Extensions/IntentsExtension/Info.plist
        CODE_SIGN_ENTITLEMENTS: Extensions/IntentsExtension/IntentsExtension.entitlements
        SKIP_INSTALL: YES
        CODE_SIGN_IDENTITY: "iPhone Developer"
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/Frameworks"
          - "@executable_path/../../Frameworks"
      release:
        CODE_SIGN_IDENTITY: "iPhone Distribution"

  # ============ Tests ============
  TheaTests:
    type: bundle.unit-test
    platform: macOS
    deploymentTarget: "26.0"
    sources:
      - path: Tests
        excludes:
          - "**/SecurityRemediationTests.swift"
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: app.thea.tests
        INFOPLIST_FILE: Tests/Info.plist
        TEST_HOST: "$(BUILT_PRODUCTS_DIR)/Thea.app/Contents/MacOS/Thea"
        BUNDLE_LOADER: "$(TEST_HOST)"
        MACOSX_DEPLOYMENT_TARGET: "26.0"
        COMBINE_HIDPI_IMAGES: YES
        CODE_SIGN_IDENTITY: "Apple Development"

        # Runpath Search Paths
        LD_RUNPATH_SEARCH_PATHS:
          - "$(inherited)"
          - "@executable_path/../Frameworks"
          - "@loader_path/../Frameworks"

    dependencies:
      - target: Thea-macOS
      - package: OpenAI
      - package: KeychainAccess

# ============================================
# Schemes
# ============================================
schemes:
  Thea-macOS:
    build:
      targets:
        Thea-macOS: all
      parallelizeBuild: true
      buildImplicitDependencies: true
    run:
      config: Debug
      commandLineArguments:
        "-com.apple.CoreData.ConcurrencyDebug": true
      environmentVariables:
        - variable: SQLITE_ENABLE_THREAD_ASSERTIONS
          value: "1"
          isEnabled: true
    test:
      config: Debug
      gatherCoverageData: true
      coverageTargets:
        - Thea-macOS
      targets:
        - name: TheaTests
          parallelizable: true
          randomExecutionOrder: true
    profile:
      config: Release
    analyze:
      config: Debug
    archive:
      config: Release
      revealArchiveInOrganizer: true

  Thea-iOS:
    build:
      targets:
        Thea-iOS: all
      parallelizeBuild: true
      buildImplicitDependencies: true
    run:
      config: Debug
      commandLineArguments:
        "-com.apple.CoreData.ConcurrencyDebug": true
    test:
      config: Debug
      gatherCoverageData: true
      coverageTargets:
        - Thea-iOS
    profile:
      config: Release
    analyze:
      config: Debug
    archive:
      config: Release
      revealArchiveInOrganizer: true

  Thea-watchOS:
    build:
      targets:
        Thea-watchOS: all
      parallelizeBuild: true
      buildImplicitDependencies: true
    run:
      config: Debug
    profile:
      config: Release
    analyze:
      config: Debug
    archive:
      config: Release
      revealArchiveInOrganizer: true

  Thea-tvOS:
    build:
      targets:
        Thea-tvOS: all
      parallelizeBuild: true
      buildImplicitDependencies: true
    run:
      config: Debug
    test:
      config: Debug
      gatherCoverageData: true
      coverageTargets:
        - Thea-tvOS
    profile:
      config: Release
    analyze:
      config: Debug
    archive:
      config: Release
      revealArchiveInOrganizer: true
